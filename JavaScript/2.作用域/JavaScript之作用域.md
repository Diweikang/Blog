# JavaScript之'瞎说'作用域
为什么标题要起为'瞎说作用域'，因为程序中很多概念是抽象的，很难通过具体的代码去具像解释，如果单从概念入手阐述概念就更晦涩难懂，所以就打算以生活中真实存在的东西类比，方便自己理解掌握。

## 何为作用域(scope)
我先抛出书中对作用域的定义：

<<JavaScript权威指南>>：程序源代码中定义变量的区域。

<<你不知道的JavaScript>>：作用域是一套设计良好的用来储存变量，并方便之后找到这些变量的规则。

JavaScript使用的是词法作用域，函数的作用域在函数定义的时候就决定了。

动态作用域：函数的作用域是在函数调用的时候决定的。

看了上面的概念我还是觉得很空泛不够具体化，那么以真实世界类比呢？

## 瞎说作用域之胡吃海喝
### 瞎说作用域
周末跟朋友去吃自助，到了商场转了转决定吃粗粮王排了号，这时吃饭这个程序代码就写完了等着编译执行，此时对我们来商场就是**全局作用域**，粗粮王是吃饭这个函数的局部作用域，其中定义了餐具、桌椅、食物、服务员等**变量**及吃、喝等**函数**。

#### 例1(伪代码)
```js
// 全局作用域 --- 商场
let 卫生间
let 饮品站
// 局部作用域 吃自助
function 吃自助() {
  let 餐具
  let 桌椅
  ...
  function 吃海鲜大虾(){
    let 虾
    ...
  }
}
function 吃火锅(){
  // 定义变量
  let 牛羊肉卷
  // 定义函数
}
```

### 越域之盘不到

过会服务员叫号说编译好可以开吃了，进去后看到大虾、羊排二话不说盘它，但是隔壁海底捞的牛羊肉卷盘不到。
#### 例2(伪代码)
```js
function 吃大虾(){
  let 虾
  ...
}
function 吃火锅(){
  let 牛羊肉卷
  ...f
}
```
上例中'吃火锅'函数作用域限制了想吃牛让肉卷只能上我们海底捞来。

### 词法作用域 -- 作用域决定于函数定义之时。

我看到隔壁桌的在吃蛋挞、布丁，我也想吃，但是那是人家的我访问不到，只能去甜品区拿。
#### 例3(伪代码)
```js
var food = '蛋挞'
function 吃蛋挞(){
  // 这里打印的是'蛋挞',不是'蛋挞1',函数定义时已经限制你只能吃甜品区的蛋挞，不能吃别人桌的蛋挞。
  console.log(food)
}
function 隔壁桌吃蛋挞(){
  var food = '蛋挞1'
  // 我想吃蛋挞
  吃蛋挞()
}

// 类别程序代码，结果打印什么
var value = 1
function foo() {
    console.log(value)
}
function bar() {
    var value = 2
    foo()
}
bar()
```

### 变量查找
过了会朋友去洗手间，先问服务员餐厅有没，餐厅没有去了商场的洗手间。
#### 例4(伪代码)
```js
// 商场作用域
var tolite = '公共洗手间'
function 餐厅(){
  var tolite = '洗手间'
  // 打印结果是'洗手间'
  console.log(tolite)
}

// 类别程序代码，结果打印什么
var value = 1
function foo() {
    var value = 2
    // 打印结果是2，如果注释掉函数内的声明打印结果就是1
    console.log(value)
}
```
上例中，首先会在餐厅(当前作用域)内找卫生间，如果有之间就用了，如果没有再去商场(上层作用域)找。

### 作用域 -- 面试题

吃自助就得整硬菜牛排，烤牛排的师傅说要么在那等煎好，要么拿个号一会领，此时我们调用了一个吃牛排的函数，吃牛排的函数中又调用
领牛排的函数，要么等煎好直接领，要么给个号码一会儿再过来领。
#### 例1
```js
// 第一种在烧烤区等师傅煎好
let pai = '猪排'
function 吃牛排() {
  let pai = '牛排'
  // 领牛排函数中没有pai，调用吃牛排中pai。
  function 领牛排(){
    return pai
  }
  return 领牛排()
}
// 打印结果是‘牛排’
console.log(吃牛排())

// 第二种拿着号码牌牌，稍后再领。
let pai = '猪排'
function 吃牛排() {
  let pai = '牛排'
  // 词法作用域决定了调用吃牛排中的pai变量。
  function 领牛排(){
    return pai
  }
  return 领牛排
}
// 吃牛排()函数执行后返回领牛排()函数，执行领牛排()函数作用域已经决定了变量的访问权限。
// 打印结果是'牛排'
console.log(吃牛排()())

// 类比：权威指南中的例子
// 第一种等牛排煎好，直接领走
var scope = "global scope";
function checkscope(){
    var scope = "local scope";
    function f(){
        return scope;
    }
    return f();
}
checkscope();

// 第二种牛排没好，领个牌牌过会领。
var scope = "global scope";
function checkscope(){
    var scope = "local scope";
    function f(){
        return scope;
    }
    return f;
}
checkscope()();
```
上例中，只要在烧烤区(吃牛排区)有牛排，烧烤是否一定不会把'猪排'给你。

**总结**：自己通过上面对'作用域'的瞎说，对作用域及作用域有关的操作，有个更加具体的认识。最后以自己的理解对作用域做个论述。

**作用域**：定义了很多标识符(变量、函数等)，同时规定了标识符访问权限的区域。